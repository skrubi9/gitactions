name: issue

on:
  push:
    branches:
      - main

# on:
#   workflow_dispatch:
#     inputs:
#       start-pipeline:
#         required: true
#         type: choice
#         description: defines if the workflow shoule be started or not
#         options: 
#           - run 

permissions:
  contents: read
  pull-requests: write

jobs:
  # manual-approve-deploy:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #     - name: create an issue
  #       uses: dacbd/create-issue-action@main
  #       with:
  #         token: ${{ github.token }}
  #         title: Deploy ${{ github.event.pull_request.title }} to Production
  #         body: |
  #           Number of commits: ${{ github.event.pull_request.commits }}
  #           URL: ${{ github.event.pull_request.html_url }}#

  #           Close ticket to merge changes into Production. 
  #         labels: deploy

  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Create Pull Request
        run: |
          PAYLOAD=$(cat <<EOF
            {
              "title": "Title of my PR",
              "body": "Automated PR to ...",
              "head": "${BRANCH_NAME}",
              "base": "main"
            }
          EOF
          )
          curl https://api.github.com/repos/my-user/other-repo/pulls \
            --header "Authorization: token ${ TOKEN }" \
            -H "Content-Type:application/json" \
            -d "$PAYLOAD"
        env:
          TOKEN: ${{ secrets.GITKEY }}

  create-pr-2:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Open PR Merge
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITKEY }}
          title: Merge to branch via evans
          branch: main
          base: staging

